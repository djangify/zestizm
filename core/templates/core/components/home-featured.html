{% load static %}

<!-- ABOUT INFO + FEATURED PRODUCTS -->
<section 
  id="home-featured" 
  class="w-full mt-8 px-4 sm:px-6 md:px-8" 
  role="region"
  aria-labelledby="about-title"
>
  <div class="max-w-5xl mx-auto px-6 sm:px-8 md:px-12">
    
    {% if featured_products %}
      <!-- Grid with About + Products -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
    {% else %}
      <!-- Single Full-Width About Box -->
      <div class="grid grid-cols-1">
    {% endif %}

        <!-- ABOUT / INTRO BOX -->
        <div class="border border-[color:var(--color-brand-accent)] p-6 flex flex-col mt-8  rounded-md {% if not featured_products %}w-full col-span-full{% endif %}">
          
          {% if homepage_settings.about_image %}
            <figure class="mb-6 flex justify-center">
              <img 
                src="{{ homepage_settings.about_image.url }}" 
                alt="{{ homepage_settings.about_title }}" 
                class="object-contain w-32 h-32 mx-auto sm:mx-0 rounded-md"
                width="128"
                height="128"
                loading="lazy"
                aria-describedby="about-title"
              >
            </figure>
          {% endif %}

          {% if homepage_settings.about_title %}
            <h2 
              id="about-title" 
              class="text-3xl font-semibold text-[color:var(--color-font-main)] mb-4 text-center"
            >
              {{ homepage_settings.about_title }}
            </h2>
          {% endif %}

          <div class="prose text-[color:var(--color-font-main)] text-base leading-relaxed mb-4">
            {{ homepage_settings.about_text|safe }}
          </div>

          {% if homepage_settings.about_cta_text and homepage_settings.about_cta_link %}
            <a 
              href="{{ homepage_settings.about_cta_link }}"
              class="text-sm border bg-[color:var(--color-brand-secondary)] font-semibold text-[color:var(--color-font-main)] px-3 py-1.5 rounded hover:bg-[color:var(--color-brand-accent)] hover:text-[color:var(--color-brand-light)] transition inline-block mx-auto w-auto"
              aria-label="{{ homepage_settings.about_cta_text }}"
            >
              {{ homepage_settings.about_cta_text }}
            </a>
          {% endif %}
        </div>

        {% if featured_products %}
          {% for product in featured_products|slice:":2" %}
            <div class="border-2 border-[color:var(--color-brand-accent)] flex flex-col justify-between hover:shadow-md transition overflow-hidden rounded-md">
              <a href="{{ product.get_absolute_url }}" class="block">
                <figure class="py-4 mx-2 flex items-center justify-center overflow-hidden bg-white rounded-md" style="height:350px;">
                  {% if product.get_image_url %}
                    <img 
                      src="{{ product.get_image_url }}" 
                      alt="Featured product: {{ product.title }}" 
                      class="object-contain w-full h-full"
                      width="350"
                      height="350"
                      loading="lazy"
                    >
                  {% else %}
                    <img 
                      src="{% static 'images/djangify-logo.png' %}" 
                      alt="Default image for {{ product.title }}" 
                      class="object-contain w-full h-full"
                      width="350"
                      height="350"
                      loading="lazy"
                    >
                  {% endif %}
                </figure>
              </a>

              <div class="p-4 flex flex-col flex-grow justify-between text-center">
                <h3 class="text-lg font-semibold text-[color:var(--color-font-main)] mb-2">{{ product.title }}</h3>

                <p class="text-sm mb-3 text-[color:var(--color-font-main)]">
                  {% if product.section_description %}
                    {{ product.section_description|striptags|truncatechars:120 }}
                  {% elif product.description %}
                    {{ product.description|striptags|truncatechars:120 }}
                  {% else %}
                    <span class="text-gray-500 italic">No description available.</span>
                  {% endif %}
                </p>

                <!-- Ratings -->
                <div class="text-gray-600 text-sm mb-3">
                  <div class="flex items-center justify-center mt-2 text-yellow-500 space-x-1">
                    {% if product.average_rating %}
                      {% for i in "12345"|make_list %}
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                          <path 
                            d="M10 15l-5.878 3.09 1.123-6.545L.49 6.91l6.562-.954L10 0l2.948 5.956 6.562.954-4.755 4.635 1.123 6.545z"
                            {% if forloop.counter <= product.average_rating %}
                              class="fill-current"
                            {% else %}
                              class="text-gray-300"
                            {% endif %}
                          ></path>
                        </svg>
                      {% endfor %}
                      <span class="text-sm text-gray-600">({{ product.reviews.count }})</span>
                    {% else %}
                      <span class="text-gray-500 italic">No reviews yet</span>
                    {% endif %}
                  </div>
                </div>

                <a 
                  href="{{ product.get_absolute_url }}"
                  class="text-sm border bg-[color:var(--color-brand-secondary)] font-semibold text-[color:var(--color-font-main)] px-3 py-1.5 rounded hover:bg-[color:var(--color-brand-accent)] hover:text-[color:var(--color-brand-light)] transition inline-block mx-auto w-auto"
                  aria-label="See details for {{ product.title }}"
                >
                  See Full Details
                </a>
              </div>
            </div>
          {% endfor %}
        {% endif %}
      </div>
  </div>
</section>
