{% load static %}
<!-- LATEST PRODUCTS -->
<section id="latest-products" class="py-6">
  <div class="max-w-5xl mx-auto px-6 md:px-12">

    {% if latest_products %}
      {% if latest_products|length == 1 %}
        {% with product=latest_products.0 %}
        <!-- Single Product Layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center border border-[color:var(--color-brand-accent)] rounded-lg bg-[color:var(--color-brand-light)] p-6 md:p-10 shadow-sm">
          
          <!-- Image -->
          <figure class="flex justify-center md:justify-start">
            {% if product.get_image_url %}
              <img src="{{ product.get_image_url }}" alt="{{ product.title }}" 
                   class="object-contain w-full max-w-md rounded-md" 
                   width="500" height="500" loading="lazy">
            {% endif %}
          </figure>

          <!-- Details -->
          <div class="text-[color:var(--color-font-main)] space-y-4 text-center md:text-left">
            <h2 class="text-3xl font-semibold text-[color:var(--color-brand-primary)]">
              {{ product.title }}
            </h2>

            {% if product.description %}
              <p class="text-base leading-relaxed">
                {{ product.description|striptags|truncatechars:400 }}
              </p>
            {% endif %}

            <!-- Price + Ratings Inline -->
            <div class="flex flex-col sm:flex-row items-center sm:justify-start justify-center gap-2 sm:gap-4 mt-2">
              <p class="text-xl font-bold text-[color:var(--color-brand-dark)]">
                ${{ product.current_price }}
              </p>
              {% if product.reviews.count > 0 %}
                <div class="flex items-center text-yellow-500 text-sm">
                  {% for i in "12345"|make_list %}
                    <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M10 15l-5.878 3.09 1.123-6.545L.49 6.91l6.562-.954L10 0l2.948 5.956 6.562.954-4.755 4.635 1.123 6.545z"
                        {% if forloop.counter <= product.average_rating %}
                          class="fill-current"
                        {% else %}
                          class="text-gray-300"
                        {% endif %}
                      ></path>
                    </svg>
                  {% endfor %}
                  <span class="ml-1 text-xs text-gray-600">({{ product.reviews.count }})</span>
                </div>
              {% endif %}
            </div>

            <a href="{{ product.get_absolute_url }}"
               class="inline-block mt-4 px-8 py-4 text-lg font-semibold rounded-md bg-[color:var(--color-brand-primary)] text-[color:var(--color-brand-light)] hover:bg-[color:var(--color-brand-secondary)] transition">
               View Product
            </a>
          </div>
        </div>
        {% endwith %}
      {% else %}
        <!-- Multiple Products Layout -->
        <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3">
          {% for product in latest_products %}
            <div class="border border-[color:var(--color-brand-accent)] rounded-lg p-4 hover:shadow-md transition-shadow duration-300 flex flex-col justify-between">
              <a href="{{ product.get_absolute_url }}">
                <figure class="mb-4 aspect-[3/4] flex items-center justify-center overflow-hidden rounded-md">
                  {% if product.get_image_url %}
                    <img src="{{ product.get_image_url }}" alt="Product - {{ product.title }}" width="700" height="900" loading="lazy" decoding="async" class="object-contain w-full h-full">
                  {% else %}
                    <img src="{% static 'images/placeholder.webp' %}" alt="" aria-hidden="true" class="object-contain w-full h-full">
                  {% endif %}
                </figure>
                <h2 class="text-lg font-semibold text-[color:var(--color-font-main)] mb-2 text-center">{{ product.title }}</h2>
              </a>

              <!-- Price + Ratings Inline -->
              <div class="flex flex-col sm:flex-row items-center justify-between mt-auto gap-2 sm:gap-4">
                <span class="text-lg font-semibold text-[color:var(--color-font-main)]">
                  ${{ product.current_price }}
                </span>
                {% if product.reviews.count > 0 %}
                  <div class="flex items-center justify-center sm:justify-end text-yellow-500 text-sm">
                    {% for i in "12345"|make_list %}
                      <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path
                          d="M10 15l-5.878 3.09 1.123-6.545L.49 6.91l6.562-.954L10 0l2.948 5.956 6.562.954-4.755 4.635 1.123 6.545z"
                          {% if forloop.counter <= product.average_rating %}
                            class="fill-current"
                          {% else %}
                            class="text-gray-300"
                          {% endif %}
                        ></path>
                      </svg>
                    {% endfor %}
                    <span class="ml-1 text-xs text-gray-600">({{ product.reviews.count }})</span>
                  </div>
                {% endif %}
              </div>

              <div class="flex justify-center sm:justify-end mt-3">
                <a href="{{ product.get_absolute_url }}"
                   class="text-sm border border-[color:var(--color-brand-secondary-contrast)] bg-[color:var(--color-brand-secondary)] font-semibold text-[color:var(--color-brand-light)] px-3 py-1.5 rounded hover:bg-[color:var(--color-brand-secondary-contrast)] hover:text-[color:var(--color-brand-light)] transition-colors">
                  View Product
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <p class="text-center text-[color:var(--color-font-main)]">Products to be added here soon.</p>
    {% endif %}

  </div>
</section>
