{% extends "base.html" %}
{% load static %}

{% block title %}{{ page.title }} - {{ site.name }}{% endblock %}

{% block extra_meta %}
{# --- Dynamic JSON-LD Schema for Policies & Documentation --- #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  {% if page.page_type == "policy" %}
    "@type": "{% if 'privacy' in page.title|lower %}PrivacyPolicy{% elif 'terms' in page.title|lower %}TermsOfService{% elif 'cookie' in page.title|lower %}WebPage{% else %}WebPage{% endif %}",
  {% elif page.page_type == "doc" %}
    "@type": "TechArticle",
  {% else %}
    "@type": "WebPage",
  {% endif %}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.build_absolute_uri }}"
  },
  "headline": "{{ page.title|escapejs }}",
  "dateModified": "{{ page.last_updated|date:'Y-m-d' }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.name }}",
    "url": "{{ request.scheme }}://{{ request.get_host }}/",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/djangify-logo.png' %}"
    }
  }
}
</script>
{% endblock %}

{% block content %}
<main id="main-content" role="main" class="w-full" aria-labelledby="page-heading">
  <article id="info-page-{{ page.slug }}"
           class="pageformat"
           itemscope
           itemtype="https://schema.org/Article">

    <!-- Header -->
    <header>
      <h1 id="page-heading"
          itemprop="headline"
          class="text-4xl font-bold text-[color:var(--color-font-main)] mb-6">
        {{ page.title }}
      </h1>
      <p class="text-sm text-[color:var(--color-font-main)]/70 mb-8" itemprop="dateModified">
        Last updated: {{ page.last_updated|date:"F Y" }}
      </p>
    </header>

    <!-- Auto-generated Table of Contents -->
    {% if toc %}
    <nav aria-label="Table of contents"
         class="mb-8 bg-[color:var(--color-brand-light)] border border-[color:var(--color-brand-accent)] p-6 rounded-lg shadow-sm">
      <h2 class="text-xl font-semibold mb-4 text-[color:var(--color-brand-primary)]">Contents</h2>
      <ol class="space-y-2">
        {% for item in toc %}
          <li>
            <a href="#{{ item.id }}"
               class="text-[color:var(--color-brand-accent)] hover:text-[color:var(--color-brand-primary)] transition-colors">
              {{ item.title }}
            </a>
          </li>
        {% endfor %}
      </ol>
    </nav>
    {% endif %}

    <!-- Page Content -->
    <div id="page-content" class="prose" itemprop="articleBody">
      {{ rendered_content|safe }}
    </div>

    <!-- Footer Navigation -->
    <footer class="mt-12 border-t border-[color:var(--color-brand-accent)] pt-6">
      <nav aria-label="Back to section">
        {% if page.page_type == "policy" %}
          <a href="{% url 'infopages:policy_index' %}"
             class="text-[color:var(--color-brand-accent)] hover:text-[color:var(--color-brand-primary)] underline transition-colors">
            Back to Policies
          </a>
        {% elif page.page_type == "doc" %}
          <a href="{% url 'infopages:docs_index' %}"
             class="text-[color:var(--color-brand-accent)] hover:text-[color:var(--color-brand-primary)] underline transition-colors">
            Back to Documentation
          </a>
        {% endif %}
      </nav>
    </footer>
  </article>
</main>
{% endblock %}
